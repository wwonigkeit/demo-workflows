direktiv_api: workflow/v1

description: Run a Docker Hub Python container without any changes

functions:
  # This is a simple Python container from hub.docker.com: docker pull python:3.9.18-slim-bookworm
  - id: python
    service: /run-docker-container/services/python.yaml
    type: knative-namespace
 
states:
  - id: print-region
    type: noop
    log: 'Received this region: jq(.region)'
    transition: run-python

  # Let's only run a single state which get the python version and run a simple command
  - id: run-python 
    type: action
    action:
      secrets: ["AWS_KEY", "AWS_SECRET"]
      function: python
      files: 
      - key: /run-docker-container/code/get-aws.py
        scope: file
        as: get-aws.py
      input:
        data:
          commands:
          - command: echo $HELLO
            envs:
            - name: HELLO
              value: world            
          # - command: pip install boto3
          # - command: python3 get-aws.py
          #   envs: 
          #   - name: AWS_ACCESS_KEY_ID
          #     value: jq(.secrets.AWS_KEY)
          #   - name: AWS_SECRET_ACCESS_KEY
          #     value: jq(.secrets.AWS_SECRET)
  #   transform: 'jq( { output: .return[0].Output })'
  #   transition: store-variable

  # - id: store-variable
  #   type: setter
  #   variables:
  #   - key: version
  #     scope: workflow
  #     mimeType: text/plain
  #     value: 'jq(.output)'