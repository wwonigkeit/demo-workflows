direktiv_api: endpoint/v1
allow_anonymous: true
path: /v1/github-event
plugins:
  inbound:    
    - type: "request-convert"
      configuration:
        omit_headers: false
        omit_queries: false
        omit_body: false
        omit_consumer: false  
    - type: "js-inbound"
      configuration:
        script: |-
            b = JSON.parse(input["body"])
            input["specversion"] = "1.0"
            input["id"] = input.headers //["X-Github-Delivery"][0]
            input["source"] = input.body.repository.git_url
            input["type"] = input.headers //.X-Github-Event
            input["subject"] = input.headers //.X-Github-Event
            input["data"] = input
            //delete input.body;
            //delete input.consumer;
            //delete input.headers;
            //delete input.query_params;
            //delete input.url_params;
            return input;
  # target:
  #   type: "target-event"
  #   configuration:
  #     namespace: "demo-workflows"
  target:
    type: "target-flow"
    configuration:
      namespace: "demo-workflows"
      flow: "/run-git-webhook/workflows/run-github-webhook-event.yaml"
      content_type: "application/json"
  auth:
    - type: "github-webhook-auth"
      configuration:
        secret: "api123"      
methods:
  - POST
timeout: 10

